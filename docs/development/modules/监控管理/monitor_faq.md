# 监控管理模块FAQ

## 常见问题

### Q1: 监控模块支持哪些指标？

**A**: 支持以下监控指标：
- **CPU** - 使用率、负载、核心数
- **内存** - 使用率、总量、可用量
- **磁盘** - 读写速度、使用率、IOPS
- **网络** - 上传/下载速度、连接数
- **GPU** - 使用率、显存、温度（需GPU支持）

**相关代码**: [monitor_v2.dart](../../../lib/api/v2/monitor_v2.dart)

### Q2: 如何查看历史监控数据？

**A**: 查看历史数据步骤：
1. 进入监控管理页面
2. 选择时间范围（1h/6h/24h/7d/30d）
3. 图表自动更新显示历史数据
4. 可拖动图表查看具体时间点

**API端点**: `POST /hosts/monitor/search`

### Q3: 监控数据保留多长时间？

**A**: 默认保留策略：
- 原始数据: 7天
- 聚合数据: 30天
- 可在监控设置中调整

### Q4: 如何配置监控采集间隔？

**A**: 配置步骤：
1. 进入监控设置页面
2. 修改采集间隔（默认30秒）
3. 保存配置

**注意**: 间隔过短会增加系统负载。

**API端点**: `POST /hosts/monitor/setting/update`

### Q5: GPU监控需要什么条件？

**A**: GPU监控要求：
- 安装NVIDIA驱动
- 安装nvidia-smi工具
- 系统支持GPU监控

### Q6: 如何清理历史监控数据？

**A**: 清理步骤：
1. 进入监控设置页面
2. 点击"清理数据"按钮
3. 选择清理范围
4. 确认清理

**API端点**: `POST /hosts/monitor/clean`

### Q7: 监控图表不显示怎么办？

**A**: 排查步骤：
1. 检查监控服务是否运行
2. 确认数据采集正常
3. 清除浏览器缓存
4. 刷新页面

### Q8: 如何导出监控数据？

**A**: 导出步骤：
1. 选择时间范围
2. 点击"导出"按钮
3. 选择导出格式（JSON/CSV）
4. 下载文件

### Q9: 监控数据可以用于告警吗？

**A**: 可以：
- 配置告警阈值
- 设置通知方式
- 触发告警通知

### Q10: 如何关闭监控功能？

**A**: 关闭步骤：
1. 进入监控设置页面
2. 关闭"启用监控"开关
3. 保存配置

### Q11: 为什么磁盘和负载数据显示为"--"？

**A**: 可能原因：
1. **磁盘数据为空**：服务器端未配置IO监控，API返回 `{param: io, date: null, value: null}`
2. **负载字段名错误**：正确的字段名是 `cpuLoad1`，不是 `load1`
3. **监控服务未启动**：服务器端监控服务未运行

**排查步骤**:
1. 检查服务器端监控配置
2. 确认IO监控已启用
3. 验证API返回的 `io.value` 是否为 `null`

**解决方案**:
- 在1Panel服务器端启用IO监控
- 确保监控服务正常运行

## 故障排查指南

### 问题1: 监控数据不更新

**可能原因**:
- 监控服务停止
- 数据采集失败
- 网络问题

**排查步骤**:
1. 检查服务状态
2. 查看错误日志
3. 验证网络连接
4. 重启监控服务

### 问题2: 图表加载缓慢

**可能原因**:
- 数据量过大
- 网络带宽不足
- 浏览器性能问题

**排查步骤**:
1. 缩小时间范围
2. 检查网络状况
3. 清理浏览器缓存
4. 优化数据查询

### 问题3: GPU监控不可用

**可能原因**:
- 驱动未安装
- nvidia-smi不可用
- 权限不足

**排查步骤**:
1. 检查GPU驱动
2. 验证nvidia-smi命令
3. 检查用户权限
4. 查看系统日志

### 问题4: 监控设置保存失败

**可能原因**:
- 权限不足
- 参数错误
- 服务异常

**排查步骤**:
1. 检查用户权限
2. 验证参数格式
3. 查看服务日志
4. 重试保存操作

### 问题5: 数据清理失败

**可能原因**:
- 数据库异常
- 磁盘空间不足
- 权限问题

**排查步骤**:
1. 检查数据库状态
2. 验证磁盘空间
3. 检查文件权限
4. 查看错误日志

## 最佳实践建议

### 开发建议

1. **使用Provider管理状态**
   ```dart
   class MonitorProvider extends ChangeNotifier {
     MonitorData? _cpuData;
     MonitorData? _memoryData;
     
     MonitorData? get cpuData => _cpuData;
     MonitorData? get memoryData => _memoryData;
     
     Future<void> loadMonitorData() async {
       // 加载监控数据
     }
   }
   ```

2. **实现自动刷新**
   ```dart
   Timer? _refreshTimer;
   
   void startAutoRefresh() {
     _refreshTimer = Timer.periodic(Duration(seconds: 30), (_) {
       refreshData();
     });
   }
   ```

3. **图表优化**
   - 使用数据采样减少渲染压力
   - 实现虚拟滚动
   - 缓存已渲染数据

### 运维建议

1. **监控配置**
   - 合理设置采集间隔
   - 控制数据保留时间
   - 定期清理历史数据

2. **性能优化**
   - 监控数据量
   - 优化查询性能
   - 合理分配资源

3. **告警配置**
   - 设置合理阈值
   - 配置多通道通知
   - 定期测试告警

### 安全建议

1. **访问控制**
   - 限制监控数据访问
   - 敏感数据脱敏
   - 操作审计日志

2. **数据安全**
   - 监控数据加密存储
   - 定期备份配置
   - 安全传输数据

---

**文档版本**: 1.0  
**最后更新**: 2026-02-14  
**维护者**: Open1Panel开发团队
