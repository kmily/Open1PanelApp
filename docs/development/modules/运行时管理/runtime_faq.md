# 运行时管理模块FAQ

## 常见问题

### Q1: 支持哪些运行时类型？

**A**: 当前支持以下运行时类型：
- **Java** - JDK 8/11/17/21
- **Node.js** - LTS版本
- **Python** - 3.8+
- **Go** - 1.18+
- **PHP** - 7.4/8.0/8.1/8.2
- **.NET** - 6.0/7.0/8.0

**相关代码**: [runtime_models.dart](../../../lib/data/models/runtime_models.dart#L4-20)

### Q2: 如何创建新的运行时？

**A**: 创建运行时步骤：
1. 进入运行时管理页面
2. 点击"创建运行时"按钮
3. 选择运行时类型
4. 填写名称、版本等配置
5. 配置环境变量（可选）
6. 点击"确定"完成创建

**API端点**: `POST /runtimes`

### Q3: 运行时状态有哪些？

**A**: 运行时状态包括：
- **running** - 运行中
- **stopped** - 已停止
- **error** - 错误状态
- **installing** - 安装中
- **upgrading** - 升级中

### Q4: 如何编辑PHP配置文件？

**A**: PHP配置编辑步骤：
1. 选择PHP运行时
2. 进入详情页面
3. 点击"配置编辑"标签
4. 在编辑器中修改配置
5. 点击"保存"提交更改

**API端点**: 
- `GET /runtimes/{id}/php/config` - 加载配置
- `POST /runtimes/php/config/update` - 保存配置

### Q5: 如何管理PHP扩展？

**A**: PHP扩展管理步骤：
1. 选择PHP运行时
2. 进入详情页面
3. 点击"扩展管理"标签
4. 查看已安装和可用扩展列表
5. 点击安装/卸载按钮进行操作

**API端点**: `GET /runtimes/{id}/extensions`

### Q6: 运行时操作（启动/停止/重启）有什么影响？

**A**: 运行时操作影响：
- **启动**: 启动运行时进程，使其可用
- **停止**: 停止运行时进程，释放资源
- **重启**: 先停止后启动，应用新配置

**注意**: 停止运行时会影响依赖该运行时的应用服务。

### Q7: 如何批量操作多个运行时？

**A**: 批量操作步骤：
1. 在列表页面勾选多个运行时
2. 点击底部操作栏的批量操作按钮
3. 选择操作类型（删除、启动、停止等）
4. 确认操作

**限制**: 批量删除最多支持50个运行时。

### Q8: 环境变量如何配置？

**A**: 环境变量配置：
- 在创建或编辑运行时时配置
- 格式为键值对：`KEY=VALUE`
- 支持引用已存在的环境变量
- 不同语言有特定的环境变量需求

**示例**:
```
Java: JAVA_OPTS=-Xmx512m
Node: NODE_ENV=production
Python: PYTHONPATH=/app/lib
```

## 故障排查指南

### 问题1: 运行时创建失败

**可能原因**:
- 版本号格式不正确
- 端口被占用
- 依赖缺失
- 权限不足

**排查步骤**:
1. 检查版本号格式（如：8.0.0）
2. 确认端口未被占用
3. 检查系统依赖是否安装
4. 确认有足够的系统权限

### 问题2: 运行时启动失败

**可能原因**:
- 配置文件错误
- 端口冲突
- 资源不足
- 依赖服务未启动

**排查步骤**:
1. 检查配置文件语法
2. 更换运行端口
3. 检查内存和磁盘空间
4. 确认依赖服务状态

### 问题3: PHP扩展安装失败

**可能原因**:
- 网络问题
- 依赖库缺失
- 版本不兼容
- 权限问题

**排查步骤**:
1. 检查网络连接
2. 安装系统依赖库
3. 确认扩展与PHP版本兼容
4. 检查文件系统权限

### 问题4: 配置保存后运行时异常

**可能原因**:
- 配置语法错误
- 参数值不合法
- 配置冲突

**排查步骤**:
1. 检查配置文件语法
2. 验证参数值范围
3. 查看运行时日志
4. 恢复默认配置

### 问题5: 状态同步延迟

**可能原因**:
- 网络延迟
- 服务器负载高
- 轮询间隔过长

**排查步骤**:
1. 检查网络连接
2. 查看服务器状态
3. 手动触发状态同步
4. 调整轮询间隔

## 最佳实践建议

### 开发建议

1. **使用Provider管理状态**
   ```dart
   class RuntimeProvider extends ChangeNotifier {
     List<RuntimeInfo> _runtimes = [];
     RuntimeInfo? _selectedRuntime;
     
     List<RuntimeInfo> get runtimes => _runtimes;
     RuntimeInfo? get selectedRuntime => _selectedRuntime;
     
     Future<void> loadRuntimes() async {
       // 加载运行时列表
     }
   }
   ```

2. **实现状态轮询**
   ```dart
   Timer? _statusTimer;
   
   void startStatusPolling() {
     _statusTimer = Timer.periodic(Duration(seconds: 30), (_) {
       syncRuntimeStatus();
     });
   }
   ```

3. **配置文件编辑器**
   - 使用代码高亮
   - 提供语法校验
   - 支持撤销/重做
   - 自动保存草稿

### 配置建议

1. **Java运行时配置**
   - 合理设置堆内存大小
   - 配置GC策略
   - 设置时区和编码

2. **Node.js运行时配置**
   - 选择合适的包管理器
   - 配置npm镜像源
   - 设置NODE_ENV

3. **Python运行时配置**
   - 使用虚拟环境隔离
   - 配置pip镜像源
   - 管理依赖版本

4. **PHP运行时配置**
   - 根据需求调整memory_limit
   - 配置合适的扩展
   - 设置时区

### 安全建议

1. **权限控制**
   - 限制运行时操作权限
   - 敏感配置加密存储
   - 操作审计日志

2. **资源限制**
   - 设置内存上限
   - 限制CPU使用
   - 控制进程数量

3. **网络安全**
   - 限制端口访问
   - 配置防火墙规则
   - 使用HTTPS

---

**文档版本**: 1.0  
**最后更新**: 2026-02-14  
**维护者**: Open1Panel开发团队
