# 系统分组模块架构设计

## 模块目标

- 适配 Open1PanelApp 作为 1Panel Linux 运维面板社区版的定位
- 提供灵活的资源分组管理能力
- 支持多种资源类型分组（应用、网站、数据库等）
- 提供分组统计和批量操作
- 统一分组管理与错误反馈

## 功能完整性清单

基于 1PanelV2OpenAPI.json 的 System Group 标签共 8 个端点:

### 分组管理
1. GET /groups - 获取分组列表
2. POST /groups - 创建分组
3. POST /groups/update - 更新分组
4. POST /groups/del - 删除分组
5. GET /groups/{id} - 获取分组详情

### 资源关联
6. POST /groups/resources - 添加资源到分组
7. POST /groups/resources/del - 从分组移除资源
8. GET /groups/{id}/resources - 获取分组内资源列表

## 业务流程与交互验证

### 分组创建流程
- 进入分组管理页面
- 点击"创建分组"按钮
- 输入分组名称和描述
- 选择分组类型（应用/网站/数据库等）
- 保存分组

### 资源分组流程
- 在资源列表页面
- 选择需要分组的资源
- 点击"添加到分组"
- 选择目标分组
- 确认关联

### 分组查询流程
- 进入资源列表页面
- 使用分组筛选器
- 选择目标分组
- 显示该分组下的资源

### 分组删除流程
- 进入分组管理页面
- 选择需要删除的分组
- 确认分组内无资源关联
- 执行删除操作

## 关键边界与异常

### 分组操作异常
- 分组名称重复的处理
- 分组删除时存在资源关联的处理
- 分组类型不匹配的处理

### 资源关联异常
- 资源已存在于其他分组的处理
- 资源类型与分组不匹配的处理
- 批量关联部分失败的处理

### 查询异常
- 分组不存在时的提示
- 空分组的展示处理
- 权限不足的处理

## 模块分层与职责

### 前端
- UI页面: 分组列表、分组详情、资源关联、分组筛选
- 状态管理: 分组列表缓存、关联状态

### 服务层
- API适配: SystemGroupV2Api
- 数据模型: Group、GroupResource等

## 数据流

1. UI触发 -> Provider/Service -> API客户端请求
2. API响应解析 -> 模型映射 -> 状态更新
3. 状态更新 -> UI刷新 -> 用户反馈
4. 资源变更 -> 关联更新 -> 分组统计刷新

## 与现有实现的差距

- 分组管理页面缺失
- 资源分组功能缺失
- 分组筛选功能缺失
- 分组统计功能缺失

## 评审记录

| 日期 | 评审人 | 结论 | 备注 |
| --- | --- | --- | --- |
| 待定 | 评审人A | 待评审 | |
| 待定 | 评审人B | 待评审 | |

---

**文档版本**: 1.0
**最后更新**: 2026-02-14
