# SSL证书管理模块FAQ

## 常见问题

### Q1: 支持哪些SSL证书类型？

**A**: 当前支持以下证书类型：
- **Let's Encrypt** - 免费自动证书（推荐）
- **自签名证书** - 内部测试使用
- **自定义证书** - 第三方CA证书上传

**相关代码**: [ssl_models.dart](../../../lib/data/models/ssl_models.dart#L4-18)

### Q2: 如何申请Let's Encrypt证书？

**A**: Let's Encrypt申请步骤：
1. 进入SSL证书管理页面
2. 点击"申请证书"按钮
3. 选择Let's Encrypt
4. 输入域名列表
5. 选择验证方式（DNS/HTTP）
6. 配置验证信息
7. 提交申请

**API端点**: `POST /websites/ssl/obtain`

### Q3: DNS验证和HTTP验证有什么区别？

**A**: 验证方式对比：

| 验证方式 | 优点 | 缺点 | 适用场景 |
|---------|------|------|---------|
| **DNS验证** | 支持通配符证书 | 需要DNS管理权限 | 有DNS管理权限 |
| **HTTP验证** | 简单快速 | 不支持通配符 | 简单网站部署 |

### Q4: 如何上传自定义SSL证书？

**A**: 自定义证书上传步骤：
1. 进入SSL证书管理页面
2. 点击"上传证书"按钮
3. 选择证书文件（.crt/.pem）
4. 选择私钥文件（.key）
5. 可选：上传证书链
6. 点击"上传"完成

**API端点**: `POST /websites/ssl/upload`

### Q5: 证书即将过期时会有提醒吗？

**A**: 是的，系统会：
- 提前30天发送过期提醒
- 提前7天再次提醒
- 提供一键续期功能
- 支持自动续期配置

### Q6: 如何配置自动续期？

**A**: 自动续期配置：
1. 在申请或编辑证书时
2. 勾选"自动续期"选项
3. 系统会在证书过期前自动续期
4. 续期成功后自动部署

**注意**: 需要确保DNS验证配置正确。

### Q7: 证书申请失败怎么办？

**A**: 常见失败原因及解决：
- **DNS验证失败**: 检查DNS记录是否正确配置
- **HTTP验证失败**: 检查验证文件是否可访问
- **域名未解析**: 确认域名已正确解析到服务器
- **端口未开放**: 确认80/443端口可访问
- **速率限制**: Let's Encrypt有速率限制，稍后重试

### Q8: 如何下载SSL证书文件？

**A**: 证书下载步骤：
1. 进入证书详情页面
2. 点击"下载"按钮
3. 选择下载格式（PEM/ZIP）
4. 保存到本地

**API端点**: `POST /websites/ssl/download`

### Q9: 证书可以关联多个网站吗？

**A**: 可以，支持：
- 单域名证书 - 关联单个域名
- 多域名证书 - 关联多个域名
- 通配符证书 - 关联所有子域名

### Q10: 如何删除SSL证书？

**A**: 删除证书步骤：
1. 进入证书详情页面
2. 点击"删除"按钮
3. 确认删除操作
4. 证书被删除，网站恢复HTTP

**注意**: 删除操作不可恢复，请谨慎操作。

## 故障排查指南

### 问题1: Let's Encrypt申请失败

**可能原因**:
- DNS记录未正确配置
- 防火墙阻止验证请求
- 域名未正确解析
- Let's Encrypt速率限制

**排查步骤**:
1. 检查DNS记录是否正确
2. 确认防火墙规则
3. 验证域名解析
4. 查看申请日志
5. 等待一段时间后重试

### 问题2: 证书验证超时

**可能原因**:
- 网络连接问题
- DNS服务器响应慢
- 服务器负载过高

**排查步骤**:
1. 检查网络连接
2. 更换DNS服务器
3. 检查服务器负载
4. 增加验证超时时间

### 问题3: 证书部署失败

**可能原因**:
- 网站配置错误
- 权限不足
- 配置文件格式错误

**排查步骤**:
1. 检查网站配置
2. 确认文件系统权限
3. 验证配置文件格式
4. 查看部署日志

### 问题4: 自动续期失败

**可能原因**:
- DNS验证配置变更
- ACME账户失效
- 域名变更

**排查步骤**:
1. 检查DNS验证配置
2. 验证ACME账户状态
3. 确认域名未变更
4. 手动触发续期

### 问题5: 证书显示已过期

**可能原因**:
- 证书确实已过期
- 系统时间错误
- 证书链不完整

**排查步骤**:
1. 检查证书有效期
2. 验证系统时间
3. 检查证书链
4. 重新申请证书

## 最佳实践建议

### 开发建议

1. **使用Provider管理状态**
   ```dart
   class SSLProvider extends ChangeNotifier {
     List<WebsiteSSL> _certificates = [];
     WebsiteSSL? _selectedCertificate;
     
     List<WebsiteSSL> get certificates => _certificates;
     WebsiteSSL? get selectedCertificate => _selectedCertificate;
     
     Future<void> loadCertificates() async {
       // 加载证书列表
     }
   }
   ```

2. **实现证书到期检测**
   ```dart
   void checkExpiringCertificates() {
     final expiring = certificates.where((cert) {
       final days = cert.daysUntilExpiry;
       return days != null && days! <= 30;
     }).toList();
     
     if (expiring.isNotEmpty) {
       showExpiryWarning(expiring);
     }
   }
   ```

3. **证书验证**
   - 提交前验证域名格式
   - 实时验证DNS记录
   - 提供详细的错误提示

### 安全建议

1. **私钥保护**
   - 加密存储私钥
   - 传输使用HTTPS
   - 限制私钥访问权限

2. **证书管理**
   - 定期检查证书有效期
   - 及时续期即将过期证书
   - 删除不再使用的证书

3. **验证配置**
   - 使用强加密算法
   - 配置合适的密钥长度
   - 启用HSTS

### 运维建议

1. **监控证书**
   - 设置到期提醒
   - 监控证书状态
   - 记录证书变更

2. **备份证书**
   - 定期备份证书文件
   - 保存私钥备份
   - 记录证书信息

3. **续期策略**
   - 配置自动续期
   - 提前手动续期
   - 测试续期流程

---

**文档版本**: 1.0  
**最后更新**: 2026-02-14  
**维护者**: Open1Panel开发团队
