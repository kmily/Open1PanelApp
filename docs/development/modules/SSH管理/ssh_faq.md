# SSH管理模块FAQ

## 常见问题

### Q1: SSH管理支持哪些功能？

**A**: SSH管理支持以下功能：
- **SSH连接管理** - 创建、编辑、删除SSH连接
- **Web终端** - 在浏览器中使用SSH终端
- **密钥管理** - 生成、上传、部署SSH密钥
- **会话管理** - 管理多个SSH会话

**相关代码**: [terminal_v2.dart](../../../lib/api/v2/terminal_v2.dart)

### Q2: 如何创建SSH连接？

**A**: 创建SSH连接步骤：
1. 进入SSH管理页面
2. 点击"添加连接"按钮
3. 填写连接信息：
   - 主机地址
   - SSH端口
   - 用户名
   - 认证方式（密码/密钥）
4. 点击"测试连接"验证
5. 点击"保存"完成创建

**API端点**: `POST /terminals`

### Q3: 支持哪些认证方式？

**A**: 支持以下认证方式：
- **密码认证** - 使用用户名和密码
- **密钥认证** - 使用SSH私钥
- **密钥+密码** - 私钥配合密码短语

### Q4: 如何使用Web终端？

**A**: 使用Web终端步骤：
1. 在SSH连接列表中找到目标连接
2. 点击"连接"按钮
3. 终端窗口自动打开
4. 输入命令进行操作

**API端点**: `POST /terminals/{id}/connect`

### Q5: 如何生成SSH密钥？

**A**: 生成SSH密钥步骤：
1. 进入密钥管理页面
2. 点击"生成密钥"按钮
3. 选择密钥类型（RSA/ED25519）
4. 设置密钥位数
5. 输入密钥描述
6. 点击"生成"

### Q6: 如何部署公钥到服务器？

**A**: 部署公钥步骤：
1. 进入密钥管理页面
2. 找到目标密钥
3. 点击"部署"按钮
4. 选择目标服务器
5. 确认部署

### Q7: SSH连接失败怎么办？

**A**: 连接失败排查：
1. 检查网络连接
2. 验证SSH服务状态
3. 确认端口是否正确
4. 检查认证信息
5. 查看防火墙规则

### Q8: 如何管理多个SSH会话？

**A**: 管理SSH会话：
1. 查看会话列表
2. 切换不同会话
3. 断开指定会话
4. 查看会话历史

### Q9: 终端支持哪些快捷键？

**A**: 终端支持常用快捷键：
- **Ctrl+C** - 中断当前命令
- **Ctrl+D** - 退出当前会话
- **Ctrl+L** - 清屏
- **Ctrl+A** - 光标移到行首
- **Ctrl+E** - 光标移到行尾
- **Tab** - 自动补全

### Q10: 如何上传下载文件？

**A**: 文件传输方式：
1. 使用SCP命令
2. 使用SFTP功能
3. 使用rz/sz命令（需安装lrzsz）

## 故障排查指南

### 问题1: 连接超时

**可能原因**:
- 网络不通
- SSH服务未启动
- 防火墙阻止
- 端口错误

**排查步骤**:
1. ping测试网络
2. 检查SSH服务状态
3. 验证防火墙规则
4. 确认端口号

### 问题2: 认证失败

**可能原因**:
- 密码错误
- 密钥不匹配
- 用户不存在
- 权限被拒绝

**排查步骤**:
1. 确认用户名密码
2. 验证密钥配置
3. 检查用户权限
4. 查看认证日志

### 问题3: 终端显示乱码

**可能原因**:
- 字符编码不匹配
- 终端类型设置错误
- 字体不支持

**排查步骤**:
1. 检查编码设置
2. 设置正确的终端类型
3. 更换支持字体
4. 重置终端配置

### 问题4: 会话断开

**可能原因**:
- 网络中断
- 服务器重启
- 超时断开

**排查步骤**:
1. 检查网络连接
2. 验证服务器状态
3. 调整超时设置
4. 使用自动重连

### 问题5: 密钥部署失败

**可能原因**:
- 权限不足
- 目录不存在
- 密钥格式错误

**排查步骤**:
1. 检查用户权限
2. 确认.ssh目录
3. 验证密钥格式
4. 查看错误日志

## 最佳实践建议

### 开发建议

1. **使用Provider管理状态**
   ```dart
   class SSHProvider extends ChangeNotifier {
     List<SSHConnection> _connections = [];
     List<SSHSession> _sessions = [];
     
     Future<void> loadConnections() async {
       // 加载连接列表
     }
   }
   ```

2. **实现WebSocket终端**
   ```dart
   class TerminalWebSocket {
     WebSocketChannel? _channel;
     
     void connect(String url) {
       _channel = WebSocketChannel.connect(Uri.parse(url));
     }
     
     void send(String data) {
       _channel?.sink.add(data);
     }
   }
   ```

3. **错误处理**
   - 处理连接超时
   - 提供重连机制
   - 记录操作日志

### 运维建议

1. **连接管理**
   - 使用密钥认证
   - 定期更换密钥
   - 限制登录IP

2. **会话管理**
   - 设置会话超时
   - 监控活跃会话
   - 及时断开无用会话

3. **安全配置**
   - 禁用密码登录
   - 限制root登录
   - 配置fail2ban

---

**文档版本**: 1.0  
**最后更新**: 2026-02-14  
**维护者**: Open1Panel开发团队
