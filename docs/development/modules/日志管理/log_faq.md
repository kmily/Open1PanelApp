# 日志管理模块FAQ

## 常见问题

### Q1: 支持哪些日志类型？

**A**: 当前支持以下日志类型：
- **系统日志** - 系统运行日志
- **应用日志** - 应用程序日志
- **安全日志** - 安全相关日志
- **操作日志** - 用户操作日志
- **访问日志** - HTTP访问日志
- **错误日志** - 错误日志
- **审计日志** - 审计日志
- **数据库日志** - 数据库日志

**相关代码**: [logs_models.dart](../../../lib/data/models/logs_models.dart#L407-428)

### Q2: 如何搜索日志？

**A**: 日志搜索支持多种条件：
1. **关键词搜索** - 在日志内容中搜索关键词
2. **时间范围** - 指定开始和结束时间
3. **日志级别** - 按级别过滤（debug/info/warning/error/fatal）
4. **日志类型** - 按类型过滤
5. **应用名称** - 按应用过滤
6. **用户/IP** - 按用户或IP过滤

**API端点**: `POST /logs/system`

### Q3: 日志级别有哪些？

**A**: 日志级别从低到高：
- **debug** - 调试信息，开发时使用
- **info** - 一般信息，正常运行记录
- **warning** - 警告信息，需要关注
- **error** - 错误信息，需要处理
- **fatal** - 致命错误，系统崩溃

### Q4: 如何导出日志？

**A**: 日志导出步骤：
1. 进入日志管理页面
2. 设置搜索条件（可选）
3. 点击"导出"按钮
4. 选择导出格式（JSON/CSV）
5. 选择时间范围
6. 点击"确认"下载

**API端点**: `POST /logs/export`

### Q5: 如何清理日志？

**A**: 日志清理方式：
- **自动清理** - 系统按配置自动清理过期日志
- **手动清理** - 选择日志类型和时间范围手动清理
- **清理策略** - 可配置保留天数

**注意**: 清理操作不可恢复，请谨慎操作。

**API端点**: `POST /core/logs/clean`

### Q6: 如何查看实时日志？

**A**: 实时日志查看步骤：
1. 进入日志管理页面
2. 选择"实时日志"标签
3. 选择日志类型
4. 日志将实时滚动显示
5. 可暂停/继续滚动

### Q7: 日志文件在哪里？

**A**: 日志文件位置：
- 系统日志: `/var/log/1panel/`
- 应用日志: `/opt/1panel/apps/{app}/logs/`
- 网站日志: `/www/sites/{site}/logs/`

**API端点**: `GET /logs/system/files`

### Q8: 如何查看日志详情？

**A**: 查看日志详情：
1. 在日志列表中点击日志条目
2. 展开查看完整信息
3. 可查看上下文日志
4. 可复制日志内容

### Q9: 日志保留多长时间？

**A**: 默认保留策略：
- 系统日志: 30天
- 应用日志: 7天
- 访问日志: 7天
- 安全日志: 90天

可在系统设置中修改保留策略。

### Q10: 如何分析日志？

**A**: 日志分析方法：
1. 使用搜索功能定位问题
2. 查看日志统计图表
3. 按错误级别过滤
4. 导出日志进行离线分析

## 故障排查指南

### 问题1: 日志加载缓慢

**可能原因**:
- 日志文件过大
- 网络传输慢
- 服务器负载高

**排查步骤**:
1. 缩小时间范围
2. 添加搜索条件
3. 检查网络连接
4. 查看服务器状态

### 问题2: 搜索无结果

**可能原因**:
- 搜索条件过于严格
- 关键词拼写错误
- 时间范围不正确

**排查步骤**:
1. 放宽搜索条件
2. 检查关键词拼写
3. 扩大时间范围
4. 尝试模糊搜索

### 问题3: 实时日志断开

**可能原因**:
- 网络连接中断
- WebSocket超时
- 服务器重启

**排查步骤**:
1. 检查网络连接
2. 刷新页面重连
3. 查看服务器状态
4. 检查WebSocket配置

### 问题4: 导出失败

**可能原因**:
- 日志量过大
- 磁盘空间不足
- 权限问题

**排查步骤**:
1. 缩小导出范围
2. 检查磁盘空间
3. 确认导出权限
4. 分批导出

### 问题5: 日志显示乱码

**可能原因**:
- 编码格式问题
- 日志格式异常
- 特殊字符处理

**排查步骤**:
1. 检查日志编码
2. 尝试不同编码格式
3. 查看原始日志文件
4. 联系技术支持

## 最佳实践建议

### 开发建议

1. **使用Provider管理状态**
   ```dart
   class LogProvider extends ChangeNotifier {
     List<LogInfo> _logs = [];
     LogSearch _searchCriteria = const LogSearch();
     
     List<LogInfo> get logs => _logs;
     LogSearch get searchCriteria => _searchCriteria;
     
     Future<void> loadLogs() async {
       // 加载日志
     }
   }
   ```

2. **实现虚拟列表**
   ```dart
   ListView.builder(
     itemCount: logs.length,
     itemBuilder: (context, index) {
       return LogItemWidget(log: logs[index]);
     },
   )
   ```

3. **日志高亮**
   - 关键词高亮显示
   - 错误级别颜色区分
   - 时间戳格式化

### 运维建议

1. **日志监控**
   - 设置错误日志告警
   - 监控日志量增长
   - 定期检查安全日志

2. **日志清理**
   - 配置自动清理策略
   - 定期手动清理大日志
   - 保留关键日志备份

3. **日志分析**
   - 定期分析错误日志
   - 统计访问趋势
   - 发现潜在问题

### 安全建议

1. **访问控制**
   - 限制日志访问权限
   - 敏感信息脱敏
   - 操作审计记录

2. **日志保护**
   - 防止日志篡改
   - 日志备份存储
   - 加密传输

---

**文档版本**: 1.0  
**最后更新**: 2026-02-14  
**维护者**: Open1Panel开发团队
