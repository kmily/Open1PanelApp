# 主机管理模块FAQ

## 常见问题

### Q1: 如何添加新主机？

**A**: 添加主机步骤：
1. 进入主机管理页面
2. 点击"添加主机"按钮
3. 填写主机信息：
   - 主机名称
   - IP地址或域名
   - SSH端口
   - 认证方式（密码/密钥）
4. 点击"测试连接"验证
5. 点击"保存"完成添加

**API端点**: `POST /core/hosts`

### Q2: 支持哪些认证方式？

**A**: 支持以下认证方式：
- **密码认证** - 使用用户名和密码
- **密钥认证** - 使用SSH私钥
- **密钥+密码** - 私钥配合密码短语

### Q3: 如何查看主机监控数据？

**A**: 查看监控数据：
1. 在主机列表中点击主机
2. 进入主机详情页面
3. 查看监控图表
4. 可选择时间范围（1h/6h/24h/7d）

**API端点**: `POST /core/hosts/{id}/monitor`

### Q4: 监控指标有哪些？

**A**: 监控指标包括：
- **CPU使用率** - 实时和历史数据
- **内存使用率** - 已用/总量/百分比
- **磁盘使用率** - 各分区使用情况
- **网络IO** - 上传/下载速度
- **系统负载** - 1/5/15分钟负载
- **运行时间** - 系统Uptime

### Q5: 如何配置告警？

**A**: 告警配置步骤：
1. 进入主机详情页面
2. 点击"监控设置"
3. 配置告警阈值：
   - CPU告警阈值
   - 内存告警阈值
   - 磁盘告警阈值
4. 配置通知方式
5. 保存配置

**API端点**: `POST /core/hosts/{id}/monitor/setting`

### Q6: 主机离线怎么办？

**A**: 主机离线排查：
1. 检查网络连接
2. 验证SSH服务状态
3. 确认认证信息正确
4. 检查防火墙规则
5. 查看系统日志

### Q7: 如何删除主机？

**A**: 删除主机步骤：
1. 在主机列表中找到目标主机
2. 点击"删除"按钮
3. 确认删除操作

**注意**: 删除主机不会影响实际服务器，仅移除管理记录。

**API端点**: `POST /core/hosts/del`

### Q8: 支持批量操作吗？

**A**: 支持：
- 批量添加主机（导入配置）
- 批量删除主机
- 批量更新监控设置

### Q9: 如何导出监控数据？

**A**: 导出监控数据：
1. 进入主机详情页面
2. 选择时间范围
3. 点击"导出"按钮
4. 选择导出格式（JSON/CSV）

### Q10: 主机数量有限制吗？

**A**: 
- 默认支持最多100台主机
- 可通过配置调整上限
- 建议根据服务器性能合理配置

## 故障排查指南

### 问题1: 主机连接失败

**可能原因**:
- 网络不通
- SSH服务未启动
- 端口被阻止
- 认证信息错误

**排查步骤**:
1. ping测试网络连通性
2. 检查SSH服务状态
3. 验证端口开放
4. 确认用户名密码/密钥

### 问题2: 监控数据不更新

**可能原因**:
- Agent未运行
- 网络延迟
- 数据采集间隔过长

**排查步骤**:
1. 检查Agent状态
2. 验证网络连接
3. 调整采集间隔
4. 查看错误日志

### 问题3: 告警未触发

**可能原因**:
- 阈值设置过高
- 通知配置错误
- 告警服务异常

**排查步骤**:
1. 检查阈值配置
2. 测试通知通道
3. 查看告警日志
4. 验证服务状态

### 问题4: 监控图表加载慢

**可能原因**:
- 数据量过大
- 网络带宽不足
- 服务器负载高

**排查步骤**:
1. 缩小时间范围
2. 检查网络状况
3. 优化数据查询
4. 增加服务器资源

### 问题5: 主机状态显示异常

**可能原因**:
- 状态同步延迟
- 缓存未更新
- 数据不一致

**排查步骤**:
1. 手动刷新状态
2. 清除缓存
3. 重新连接主机
4. 检查数据一致性

## 最佳实践建议

### 开发建议

1. **使用Provider管理状态**
   ```dart
   class HostProvider extends ChangeNotifier {
     List<HostInfo> _hosts = [];
     HostInfo? _selectedHost;
     
     List<HostInfo> get hosts => _hosts;
     HostInfo? get selectedHost => _selectedHost;
     
     Future<void> loadHosts() async {
       // 加载主机列表
     }
   }
   ```

2. **实现状态轮询**
   ```dart
   Timer? _monitorTimer;
   
   void startMonitorPolling(int hostId) {
     _monitorTimer = Timer.periodic(Duration(seconds: 30), (_) {
       refreshMonitorData(hostId);
     });
   }
   ```

3. **错误处理**
   - 连接失败显示友好提示
   - 提供重试机制
   - 记录错误日志

### 运维建议

1. **主机管理**
   - 定期检查主机状态
   - 及时清理无效主机
   - 保持认证信息更新

2. **监控配置**
   - 合理设置告警阈值
   - 配置多通道通知
   - 定期测试告警功能

3. **性能优化**
   - 控制监控数据保留时间
   - 优化数据查询频率
   - 合理分配资源

### 安全建议

1. **认证安全**
   - 优先使用密钥认证
   - 定期更换密码/密钥
   - 限制登录尝试次数

2. **网络安全**
   - 使用VPN或内网连接
   - 配置IP白名单
   - 启用SSH加密

3. **数据安全**
   - 加密存储认证信息
   - 定期备份配置
   - 审计操作日志

---

**文档版本**: 1.0  
**最后更新**: 2026-02-14  
**维护者**: Open1Panel开发团队
