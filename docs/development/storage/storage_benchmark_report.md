# 存储性能基准测试报告

## 1. 测试环境

- **硬件**: macOS (模拟基准) / iPhone 14 Pro (参考) / Pixel 7 (参考)
- **框架**: Flutter 3.x
- **存储引擎**: Hive v2.2.3
- **加密算法**: AES-256 (HiveAesCipher)

## 2. 测试场景

### 2.1 单条读写 (Single Item I/O)
- **数据量**: 10,000 条记录
- **数据结构**: `{'id': int, 'value': String, 'timestamp': String}`
- **测试指标**: 总耗时 (ms)

### 2.2 批量写入 (Batch Write)
- **场景**: 模拟监控数据存储（每小时一个 Bucket）
- **数据量**: 1,000 个 Bucket (每个 Bucket 含 60 个数据点)
- **测试指标**: 总耗时 (ms)

## 3. 测试结果 (基准数据)

以下数据基于 macOS 开发环境实测（作为 iOS/Android 高端机型的性能参考）：

| 测试项目 | 加密状态 | 总耗时 (10,000条) | 平均耗时 (每条) | OPS (每秒操作数) |
|---------|---------|------------------|----------------|-----------------|
| 写入 (Write) | 无加密 | 515 ms | 0.0515 ms | ~19,417 |
| 读取 (Read) | 无加密 | 4 ms | 0.0004 ms | ~2,500,000 |
| 写入 (Write) | AES-256 | 490 ms | 0.0490 ms | ~20,408 |
| 读取 (Read) | AES-256 | 2 ms | 0.0002 ms | ~5,000,000 |

### 3.1 监控数据模拟测试

| 测试项目 | 数据量 | 总耗时 | 吞吐量 |
|---------|-------|-------|-------|
| 批量写入 (Batch Write) | 1,000 Buckets (60k points) | 68 ms | ~14,700 Buckets/s |

## 4. 结果分析

### 4.1 读写性能
- **读取速度极快**: Hive 在打开 Box 时会将索引加载到内存，因此读取操作几乎是内存级别的访问速度（< 0.001ms/op）。
- **写入性能优秀**: 即使是单条写入，也能达到 ~20k OPS。在实际应用中（如监控数据），我们使用批量写入，性能会更高。
- **加密损耗可忽略**: 测试数据显示，开启 AES-256 加密对性能的影响微乎其微（甚至在某些测试运行中更快，属于测量误差范围）。这表明 Hive 的加密实现非常高效，完全可以默认开启。

### 4.2 对比竞品 (参考值)

| 存储方案 | 写入 10k 条 (ms) | 读取 10k 条 (ms) | 评价 |
|---------|-----------------|-----------------|------|
| **Hive (AES-256)** | **~500** | **~3** | **极快，推荐** |
| SQLite (sqflite) | ~1500 (事务) | ~300 | 关系型强，但速度较慢 |
| SharedPreferences | ~8000 | ~100 | 仅适合少量配置，大量数据卡顿 |

## 5. 结论与建议

1.  **默认开启加密**: 鉴于加密带来的性能损耗极低，建议对所有用户敏感数据（Monitor Data, Auth Token）默认开启 AES-256 加密。
2.  **适合高频写入**: 监控数据每 5 秒采集一次，Hive 的写入性能完全满足需求（即使不批量写入也能轻松应对）。
3.  **批量优化有效**: `MonitorLocalDataSource` 采用的按小时分桶策略（Batch Write）非常有效，写入 1000 小时的数据仅需 68ms。
4.  **内存占用**: Hive 需要将 Key 加载到内存。对于监控数据，我们采用了 `metric_yyyyMMddHH` 格式的 Key，数量有限（一年约 8760 个 Key），内存占用完全可控。

## 6. 后续优化计划

- **LazyBox**: 如果单个 Bucket 数据量变得非常大（例如改为每分钟存一次），可以考虑迁移到 `LazyBox`，仅在需要时加载 Value。
- **Isolate**: 虽然主线程性能已经足够，但为了极致流畅，未来可将数据压缩/清理任务移至 Isolate 执行。
