# UI流程设计

## 1. 概述

本文档详细描述了1Panel移动端APP的用户界面流程设计，包括导航结构、界面流程和用户交互设计，为UI/UX设计和前端开发提供清晰的指导。本设计基于Material You Design 3设计规范，并结合了移动应用的最佳实践。

应用主要特点包括多服务器管理、支持1Panel v1和v2 API、引导式配置流程、可选的AI服务集成以及配置备份功能。

## 2. 导航结构

### 2.1 整体导航模式

1Panel移动端APP采用以下导航模式：
- **底部标签栏导航**: 用于主要功能模块的快速切换
- **侧边菜单导航**: 用于次要功能和设置的访问
- **栈式导航**: 用于页面间的深入浏览和返回
- **抽屉导航**: 用于显示详细信息或操作选项

### 2.2 底部标签栏结构

底部标签栏包含应用的核心功能模块，方便用户快速切换：

| 图标 | 标签 | 功能描述 | 路由 |
|------|------|----------|------|
| 📊 | 仪表盘 | 显示系统概览和实时监控数据 | `/dashboard` |
| 📱 | 应用 | 管理已安装的应用和应用市场 | `/apps` |
| 📦 | 容器 | 管理Docker容器 | `/containers` |
| 🌐 | 网站 | 管理网站和SSL证书 | `/websites` |

### 2.3 侧边菜单结构

侧边菜单包含次要功能和设置选项：

| 图标 | 标签 | 功能描述 | 路由 |
|------|------|----------|------|
| 💻 | 服务器 | 服务器连接管理 | `/servers` |
| 📁 | 文件管理 | 浏览和管理服务器文件 | `/files` |
| 📥 | 备份 | 管理系统和应用备份 | `/backups` |
| 🔧 | 设置 | 应用设置和偏好配置 | `/settings` |
| ℹ️ | 关于 | 应用版本和作者信息 | `/about` |
| 🚪 | 退出登录 | 退出当前服务器连接 | - |

## 3. 界面流程设计

### 3.1 首次启动引导流程 (OOBE)

```
首次启动应用 → 显示引导页 → 显示EULA和隐私政策 → 用户同意 → 显示服务器添加向导 → 选择服务器版本(v1/v2) → 输入服务器连接信息 → 连接成功 → 进入主界面
```

**关键界面**: 
- **引导页**: 介绍应用主要功能和特点的多页卡片式引导
- **EULA和隐私政策页**: 显示用户许可协议和隐私政策，强调所有服务均为App与服务器直接通信，不会上传Token到任何服务器(用户自己的服务器除外)
- **服务器添加向导**: 引导用户配置服务器连接，包括选择API版本(v1/v2)、输入服务器地址、端口、选择认证方式
- **自定义Token配置页**: 引导用户如何获取和配置1Panel访问令牌

### 3.2 启动与认证流程

```
启动应用 → 检查是否有已保存的服务器连接 → 是 → 显示服务器选择界面 → 选择服务器 → 自动登录 → 主界面
                                        ↓ 否
                                   显示添加服务器界面 → 输入服务器信息 → 手动登录 → 主界面
```

**关键界面**: 
- **启动页**: 显示应用Logo和品牌信息
- **服务器选择页**: 显示已保存的服务器列表，提供添加新服务器的入口
- **添加服务器页**: 表单用于输入服务器连接信息
- **登录页**: 表单用于输入用户名和密码

### 3.2 主界面与底部标签导航流程

```
主界面 → 点击底部标签 → 切换到对应功能模块
      → 点击侧边菜单按钮 → 显示侧边菜单 → 选择功能 → 跳转到对应页面
```

**关键界面**: 
- **主界面**: 包含底部标签栏和当前选中模块的内容
- **侧边菜单**: 从左侧滑出，显示次要功能和设置选项

### 3.3 仪表盘模块流程

```
仪表盘 → 显示系统概览卡片 → 点击卡片 → 显示详细信息
      → 显示资源使用图表 → 图表可交互，支持时间范围选择
      → 显示快速操作按钮 → 点击执行相应操作
```

**关键界面**: 
- **仪表盘页**: 显示系统概览、资源使用图表和快速操作按钮
- **系统详情页**: 显示详细的系统信息和监控数据

### 3.4 应用管理模块流程

```
应用列表 → 下拉刷新 → 显示最新应用列表
       → 点击应用项 → 应用详情页
       → 点击筛选按钮 → 显示筛选条件 → 应用筛选
       → 点击排序按钮 → 显示排序选项 → 应用排序
       → 点击安装按钮 → 应用市场页 → 选择应用 → 安装向导
       → 长按应用项 → 显示操作菜单 → 执行操作(启动/停止/卸载)

应用详情 → 显示应用信息和状态
       → 显示操作按钮 → 执行操作(启动/停止/重启/卸载)
       → 显示配置选项 → 查看/编辑配置
       → 显示日志选项 → 查看应用日志
```

**关键界面**: 
- **应用列表页**: 显示已安装的应用列表
- **应用详情页**: 显示应用的详细信息和操作选项
- **应用市场页**: 显示可安装的应用列表
- **应用安装向导**: 引导用户完成应用安装配置
- **应用配置页**: 用于查看和编辑应用配置
- **应用日志页**: 显示应用的运行日志

### 3.5 容器管理模块流程

```
容器列表 → 下拉刷新 → 显示最新容器列表
         → 点击容器项 → 容器详情页
         → 点击筛选按钮 → 显示筛选条件 → 应用筛选
         → 点击排序按钮 → 显示排序选项 → 应用排序
         → 长按容器项 → 显示操作菜单 → 执行操作(启动/停止/删除)

容器详情 → 显示容器信息和状态
         → 显示操作按钮 → 执行操作(启动/停止/重启/删除)
         → 显示资源使用图表 → 查看容器资源使用情况
         → 显示日志选项 → 查看容器日志
         → 显示终端选项 → 进入容器终端
```

**关键界面**: 
- **容器列表页**: 显示所有容器列表
- **容器详情页**: 显示容器的详细信息和操作选项
- **容器日志页**: 显示容器的运行日志
- **容器终端页**: 提供容器的命令行终端界面

### 3.6 网站管理模块流程

```
网站列表 → 下拉刷新 → 显示最新网站列表
         → 点击网站项 → 网站详情页
         → 点击筛选按钮 → 显示筛选条件 → 应用筛选
         → 点击排序按钮 → 显示排序选项 → 应用排序
         → 点击添加按钮 → 添加网站向导
         → 长按网站项 → 显示操作菜单 → 执行操作(删除/申请SSL)

网站详情 → 显示网站信息和状态
         → 显示操作按钮 → 执行操作(编辑/删除/申请SSL/强制HTTPS)
         → 显示访问统计 → 查看网站访问数据
```

**关键界面**: 
- **网站列表页**: 显示所有网站列表
- **网站详情页**: 显示网站的详细信息和操作选项
- **添加网站向导**: 引导用户完成网站创建配置
- **网站编辑页**: 用于编辑网站配置
- **SSL申请页**: 用于申请和管理SSL证书

### 3.7 文件管理模块流程

```
文件浏览 → 显示当前目录内容
         → 点击文件夹 → 进入子目录
         → 点击返回按钮 → 返回父目录
         → 点击文件项 → 查看文件详情/打开文件
         → 长按文件/文件夹 → 显示操作菜单 → 执行操作(重命名/删除/复制/移动/下载/上传)
         → 点击上传按钮 → 选择文件 → 上传文件
         → 点击新建按钮 → 新建文件/文件夹
```

**关键界面**: 
- **文件浏览页**: 显示目录内容和文件操作选项
- **文件详情页**: 显示文件的详细信息
- **文件编辑器**: 用于编辑文本文件
- **文件上传页**: 用于选择和上传文件

### 3.8 备份管理模块流程

```
备份列表 → 下拉刷新 → 显示最新备份列表
         → 点击备份项 → 备份详情页
         → 点击筛选按钮 → 显示筛选条件 → 应用筛选
         → 点击排序按钮 → 显示排序选项 → 应用排序
         → 点击添加按钮 → 创建备份向导
         → 长按备份项 → 显示操作菜单 → 执行操作(恢复/删除)

备份详情 → 显示备份信息和状态
         → 显示操作按钮 → 执行操作(恢复/删除)
         → 显示备份内容 → 查看备份包含的文件和数据
```

**关键界面**: 
- **备份列表页**: 显示所有备份列表
- **备份详情页**: 显示备份的详细信息和操作选项
- **创建备份向导**: 引导用户完成备份配置

### 3.9 多服务器管理模块流程

```
服务器列表 → 显示已保存的服务器连接列表(包含服务器名称、地址、状态、API版本)
           → 点击服务器项 → 连接到服务器
           → 点击添加按钮 → 添加服务器向导
           → 长按服务器项 → 显示操作菜单 → 执行操作(编辑/删除/重命名/测试连接)
           → 滑动服务器项 → 快速切换或删除

添加/编辑服务器 → 表单用于输入/修改服务器连接信息(地址、端口、API版本、认证方式)
                  → 支持手动输入URL或扫描二维码(如果官方支持)
                  → 支持自定义Token配置
```

**关键界面**: 
- **服务器列表页**: 显示已保存的服务器连接列表，支持快速切换和管理
- **添加/编辑服务器页**: 表单用于输入服务器连接信息，包含API版本选择(v1/v2)
- **服务器详情页**: 显示服务器连接状态、资源概览等信息

### 3.10 设置模块流程

```
设置首页 → 显示设置分类列表
        → 点击分类项 → 进入对应设置页面

通用设置 → 主题设置(亮色/暗色/跟随系统)
        → 语言设置
        → 通知设置
        → 缓存清理

账户与安全 → EULA和隐私政策查看
        → 认证方式设置
        → 数据加密选项

配置备份 → 配置文件备份与恢复
        → WebDAV备份目标设置(TODO)

高级设置 → 调试模式开关
        → 日志级别设置
        → 网络超时设置
        → 清除所有数据
```

**关键界面**: 
- **设置首页**: 显示所有设置分类
- **通用设置页**: 包含主题、语言、通知等基础设置
- **账户与安全页**: 显示EULA和隐私政策，提供认证相关设置
- **配置备份页**: 提供配置文件备份和恢复功能
- **高级设置页**: 包含调试、日志、网络等高级设置

## 4. 用户交互设计

### 4.1 通用交互模式

- **下拉刷新**: 大多数列表页面支持下拉刷新，获取最新数据
- **上拉加载**: 长列表支持分页加载，上拉显示更多内容
- **滑动删除**: 部分列表项支持滑动删除操作
- **长按菜单**: 长按列表项显示上下文菜单
- **点击反馈**: 所有可点击元素都有适当的点击反馈
- **加载状态**: 网络请求期间显示加载指示器
- **空状态**: 数据为空时显示友好的空状态提示
- **错误状态**: 操作失败时显示错误提示和重试选项

### 4.2 对话框与提示

- **确认对话框**: 用于危险操作的二次确认
- **信息对话框**: 用于显示重要信息或简单的选择
- **底部弹窗**: 用于显示更多操作选项或表单
- **Toast提示**: 用于显示短期的操作结果反馈
- **Snackbar提示**: 用于显示可交互的操作结果反馈
- **进度条**: 用于显示长时间操作的进度

### 4.3 手势操作

- **点击**: 选择或执行操作
- **长按**: 显示上下文菜单或进入编辑模式
- **滑动**: 滑动列表、切换页面或显示操作按钮
- **捏合缩放**: 在图表或图片查看器中使用
- **双击**: 在某些场景下用于快速操作

## 5. 界面状态管理

### 5.1 加载状态

- **初始加载**: 页面首次加载数据时显示全局加载指示器
- **局部加载**: 页面部分内容刷新时显示局部加载指示器
- **骨架屏**: 在数据加载完成前显示内容骨架，提升用户体验

### 5.2 错误状态

- **网络错误**: 显示网络连接问题的提示和重试按钮
- **服务器错误**: 显示服务器响应问题的提示
- **权限错误**: 显示权限不足的提示
- **数据错误**: 显示数据解析或验证失败的提示

### 5.3 空状态

- **列表空状态**: 当列表没有数据时显示友好的提示和操作建议
- **搜索空状态**: 当搜索没有结果时显示搜索无结果的提示
- **功能未使用状态**: 对于尚未使用的功能，显示引导性提示

## 6. 路由设计

### 6.1 路由结构

使用Flutter的`Navigator`和`MaterialApp.router`进行路由管理，采用命名路由的方式定义所有页面。

```dart
// 主路由定义示例
final router = GoRouter(
  routes: [
    GoRoute(
      path: '/',
      name: 'splash',
      builder: (context, state) => SplashScreen(),
    ),
    // 首次启动引导流程
    GoRoute(
      path: '/onboarding',
      name: 'onboarding',
      builder: (context, state) => OnboardingScreen(),
    ),
    GoRoute(
      path: '/eula',
      name: 'eula',
      builder: (context, state) => EulaScreen(),
    ),
    GoRoute(
      path: '/server-wizard',
      name: 'server-wizard',
      builder: (context, state) => ServerWizardScreen(),
    ),
    // 服务器管理
    GoRoute(
      path: '/server-select',
      name: 'server-select',
      builder: (context, state) => ServerSelectScreen(),
    ),
    GoRoute(
      path: '/add-server',
      name: 'add-server',
      builder: (context, state) => AddServerScreen(),
    ),
    GoRoute(
      path: '/edit-server/:id',
      name: 'edit-server',
      builder: (context, state) => EditServerScreen(
        serverId: state.params['id']!,
      ),
    ),
    GoRoute(
      path: '/login',
      name: 'login',
      builder: (context, state) => LoginScreen(),
      params: {
        'serverId': StringParam(),
      },
    ),
    // 主布局路由，包含底部标签栏和侧边菜单
    ShellRoute(
      builder: (context, state, child) => MainLayout(child: child),
      routes: [
        GoRoute(
          path: '/dashboard',
          name: 'dashboard',
          builder: (context, state) => DashboardScreen(),
        ),
        GoRoute(
          path: '/apps',
          name: 'apps',
          builder: (context, state) => AppsScreen(),
        ),
        GoRoute(
          path: '/containers',
          name: 'containers',
          builder: (context, state) => ContainersScreen(),
        ),
        GoRoute(
          path: '/websites',
          name: 'websites',
          builder: (context, state) => WebsitesScreen(),
        ),
        GoRoute(
          path: '/files',
          name: 'files',
          builder: (context, state) => FilesScreen(),
        ),
        GoRoute(
          path: '/backups',
          name: 'backups',
          builder: (context, state) => BackupsScreen(),
        ),
        GoRoute(
          path: '/servers',
          name: 'servers',
          builder: (context, state) => ServerManagementScreen(),
        ),
        GoRoute(
          path: '/settings',
          name: 'settings',
          builder: (context, state) => SettingsScreen(),
        ),
        GoRoute(
          path: '/about',
          name: 'about',
          builder: (context, state) => AboutScreen(),
        ),
        // AI服务模块
        GoRoute(
          path: '/ai-services',
          name: 'ai-services',
          builder: (context, state) => AIServicesScreen(),
        ),
      ],
    ),
    // 其他页面路由...
  ],
);
```

### 6.2 路由导航示例

```dart
// 基本导航
context.pushNamed('dashboard');

// 带参数的导航
context.pushNamed('app-detail', params: {'id': appId});

// 返回上一页
context.pop();

// 返回首页
context.goNamed('dashboard');
```

## 7. 响应式设计

### 7.1 屏幕适配策略

- 使用Flutter的布局组件（如Flex、Column、Row、Expanded等）实现自适应布局
- 使用`LayoutBuilder`和`MediaQuery`获取屏幕尺寸，实现不同尺寸设备的适配
- 对于关键UI元素，使用`FittedBox`或`SizedBox`控制其大小和比例
- 字体大小使用相对单位（如sp），确保在不同分辨率设备上显示一致

### 7.2 横屏适配

- 主要功能模块支持横屏模式
- 在横屏模式下，优化布局以充分利用屏幕空间
- 某些复杂表单或数据展示页面可能在横屏模式下提供更丰富的信息展示

## 8. 无障碍设计

### 8.1 可访问性支持

- 为所有交互元素添加语义标签（Semantics）
- 支持屏幕阅读器（TalkBack、VoiceOver）
- 确保文字与背景的对比度符合可访问性标准
- 提供足够大的触摸目标（至少48x48dp）

### 8.2 键盘导航支持

- 所有表单和交互元素支持键盘导航
- 合理设置焦点顺序
- 提供键盘快捷键支持

## 9. 过渡动画设计

### 9.1 页面过渡

- 使用Material Design默认的页面过渡动画
- 为特殊场景（如模态框、底部弹窗）设计专用的过渡动画
- 确保动画流畅，不影响应用性能

### 9.2 元素动画

- 列表项加载时使用渐入动画
- 按钮和卡片在悬停或点击时使用微动画
- 数据更新时使用平滑的过渡动画
- 使用动画来引导用户注意力（如加载指示器、操作成功反馈）

## 10. 典型用户场景流程

### 10.1 首次启动与服务器连接

```
用户操作: 下载并安装应用 → 首次打开应用
系统反馈: 显示启动页 → 显示引导页 → 显示EULA和隐私政策

用户操作: 阅读并同意EULA和隐私政策 → 进入服务器添加向导
系统反馈: 显示API版本选择界面(v1/v2)

用户操作: 选择API版本 → 输入服务器地址、端口 → 选择认证方式(用户名密码/自定义Token)
系统反馈: 显示登录页(如果选择用户名密码)或Token配置页(如果选择自定义Token)

用户操作: 输入用户名和密码或配置Token → 点击"连接"
系统反馈: 显示加载指示器 → 验证成功 → 进入仪表盘页面
```

### 10.2 应用管理场景

```
用户操作: 从底部标签栏点击"应用" → 进入应用列表页
系统反馈: 显示已安装应用列表

用户操作: 点击一个已安装的应用 → 进入应用详情页
系统反馈: 显示应用详细信息和状态

用户操作: 点击"停止"按钮 → 确认停止应用
系统反馈: 显示加载指示器 → 应用状态更新为已停止 → 显示操作成功提示

用户操作: 点击"安装新应用" → 进入应用市场页 → 选择一个应用 → 点击"安装"
系统反馈: 显示应用安装向导 → 引导用户完成配置 → 显示安装进度 → 安装完成提示
```

### 10.3 系统监控场景

```
用户操作: 从底部标签栏点击"仪表盘" → 进入仪表盘页面
系统反馈: 显示系统概览卡片和资源使用图表

用户操作: 观察CPU使用率图表 → 发现使用率异常高
系统反馈: 图表实时更新 → 显示当前资源使用状况

用户操作: 点击CPU卡片 → 进入系统详情页
系统反馈: 显示更详细的系统信息和监控数据

用户操作: 查看哪些进程占用资源较高
系统反馈: 显示进程列表和资源占用情况
```

### 10.4 AI服务集成场景

```
用户操作: 从侧边菜单点击"AI服务" → 进入AI服务页面
系统反馈: 显示AI服务列表和状态

用户操作: 选择一项AI服务 → 查看详情
系统反馈: 显示AI服务配置和使用说明

用户操作: 点击"启用"按钮 → 选择API提供商(内置/自定义) → 输入配置信息
系统反馈: 显示加载指示器 → 配置成功 → 显示AI服务已启用状态

用户操作: 使用AI功能(如文件分析、系统优化建议等)
系统反馈: 处理请求 → 显示AI生成的结果
```

### 10.5 配置备份与恢复场景

```
用户操作: 从设置页面点击"配置备份" → 进入配置备份页面
系统反馈: 显示备份历史和操作选项

用户操作: 点击"创建备份" → 选择备份目标(本地/WebDAV)
系统反馈: 显示备份进度 → 备份完成提示

用户操作: 点击"恢复备份" → 选择备份文件
系统反馈: 显示恢复确认 → 执行恢复 → 恢复完成提示
```

## 11. 首页和各页面详细设计

### 11.1 首页(仪表盘)设计

- **布局结构**: 顶部应用栏+内容区+底部标签栏
- **顶部应用栏**: 显示当前连接的服务器名称、刷新按钮、设置按钮
- **内容区**: 
  - 系统概览卡片(显示CPU、内存、磁盘使用率)
  - 快速操作按钮(如重启服务器、清理缓存等)
  - 资源使用趋势图表
  - 最近活动日志
  - 重要通知
- **底部标签栏**: 仪表盘、应用、容器、网站

### 11.2 应用管理页面设计

- **布局结构**: 顶部搜索栏+筛选器+应用列表+浮动操作按钮
- **应用列表**: 卡片式布局，显示应用图标、名称、版本、状态
- **卡片交互**: 点击查看详情，长按显示操作菜单
- **筛选功能**: 按状态(运行中/已停止)、按类型分类
- **搜索功能**: 按应用名称搜索

### 11.3 容器管理页面设计

- **布局结构**: 顶部搜索栏+筛选器+容器列表+浮动操作按钮
- **容器列表**: 卡片式布局，显示容器名称、镜像、状态、资源使用
- **卡片交互**: 点击查看详情，长按显示操作菜单
- **筛选功能**: 按状态(运行中/已停止/已创建)筛选
- **搜索功能**: 按容器名称搜索

### 11.4 网站管理页面设计

- **布局结构**: 顶部搜索栏+筛选器+网站列表+浮动操作按钮
- **网站列表**: 卡片式布局，显示域名、状态、SSL证书信息
- **卡片交互**: 点击查看详情，长按显示操作菜单
- **搜索功能**: 按域名搜索

### 11.5 文件管理页面设计

- **布局结构**: 顶部路径导航+文件操作栏+文件列表+浮动操作按钮
- **文件列表**: 列表式布局，显示文件/文件夹图标、名称、大小、修改日期
- **文件操作**: 新建、上传、下载、删除、重命名、移动、复制
- **视图切换**: 支持列表视图和网格视图

---

本UI流程设计文档会根据项目需求和用户反馈进行定期更新。如有任何问题或建议，请联系设计和开发团队。