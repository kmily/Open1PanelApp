# é”™è¯¯æç¤ºç³»ç»Ÿæ”¹è¿›æ€»ç»“

## é—®é¢˜èƒŒæ™¯

ç”¨æˆ·åé¦ˆåœ¨æœåŠ¡å™¨ç®¡ç†æ¨¡å—ä½¿ç”¨æ—¶æç¤º"æ— æ³•è¿æ¥æœåŠ¡å™¨"ï¼Œä½†çœ‹ä¸åˆ°å…·ä½“çš„é”™è¯¯åŸå› ï¼Œå¯¼è‡´æ— æ³•å¿«é€Ÿå®šä½å’Œè§£å†³é—®é¢˜ã€‚åŒæ—¶ï¼Œæ–°æ‰‹ç”¨æˆ·éœ€è¦æ›´å‹å¥½çš„é”™è¯¯æç¤ºå’Œè§£å†³å»ºè®®ã€‚

## æ”¹è¿›å†…å®¹

### 1. åˆ›å»ºç»Ÿä¸€çš„é”™è¯¯å¤„ç†ç³»ç»Ÿ

#### æ–°å¢æ–‡ä»¶
- **`lib/core/services/error_handler_service.dart`**: æ ¸å¿ƒé”™è¯¯å¤„ç†æœåŠ¡
  - è‡ªåŠ¨è¯†åˆ«DioExceptionç±»å‹å¹¶è½¬æ¢ä¸ºå‹å¥½æ¶ˆæ¯
  - æä¾›è¯¦ç»†çš„é”™è¯¯å¯¹è¯æ¡†ç»„ä»¶
  - æ”¯æŒæŸ¥çœ‹å®Œæ•´é”™è¯¯æ—¥å¿—ï¼ˆå¼€å‘è€…æ¨¡å¼ï¼‰

- **`lib/core/services/error_helper.dart`**: é”™è¯¯å¤„ç†è¾…åŠ©å·¥å…·ç±»
  - é¢„å®šä¹‰çš„é”™è¯¯/ç©ºçŠ¶æ€/åŠ è½½è§†å›¾ç»„ä»¶
  - ç»Ÿä¸€çš„SnackBaræç¤ºæ–¹æ³•
  - å¼‚æ­¥æ“ä½œå¤„ç†å°è£…

### 2. å®Œå–„å›½é™…åŒ–é”™è¯¯æ¶ˆæ¯

åœ¨ `app_zh.arb` å’Œ `app_en.arb` ä¸­æ–°å¢äº†80+æ¡é”™è¯¯æ¶ˆæ¯ï¼ŒåŒ…æ‹¬ï¼š

**ç½‘ç»œè¿æ¥é”™è¯¯:**
- è¿æ¥è¶…æ—¶ã€å‘é€è¶…æ—¶ã€æ¥æ”¶è¶…æ—¶
- è¿æ¥è¢«æ‹’ç»ã€ä¸»æœºæœªæ‰¾åˆ°ã€ç½‘ç»œä¸å¯è¾¾
- SSLè¯ä¹¦é”™è¯¯ã€æ— ç½‘ç»œè¿æ¥ç­‰

**è¿æ¥æµ‹è¯•é”™è¯¯ï¼ˆè¯¦ç»†è§£å†³æ–¹æ¡ˆï¼‰:**
- `errorConnectionTestTimeout`: åŒ…å«4é¡¹æ£€æŸ¥æ¸…å•
- `errorConnectionTestInvalidUrl`: URLæ ¼å¼è¯´æ˜
- `errorConnectionTestInvalidKey`: 4é¡¹å¯†é’¥æ£€æŸ¥æ¸…å•
- `errorConnectionTestServerDown`: 4é¡¹æœåŠ¡å™¨æ£€æŸ¥æ¸…å•

**HTTPçŠ¶æ€ç é”™è¯¯:**
- 400, 401, 403, 404, 500, 502, 503, 504ç­‰

**ç”¨æˆ·å‹å¥½çš„æç¤ºä¿¡æ¯:**
- ğŸ’¡ æ£€æŸ¥ç½‘ç»œè¿æ¥
- ğŸ’¡ æ£€æŸ¥æœåŠ¡å™¨é…ç½®
- ğŸ’¡ æ£€æŸ¥æœåŠ¡å™¨çŠ¶æ€
- ğŸ’¡ è”ç³»æŠ€æœ¯æ”¯æŒ
- ğŸ’¡ ç¨åé‡è¯•

### 3. æ”¹è¿›æœåŠ¡å™¨ç®¡ç†æ¨¡å—

#### `server_connection_service.dart`
- æ·»åŠ  `ServerConnectionErrorType` æšä¸¾ï¼Œæ˜ç¡®é”™è¯¯ç±»å‹
- æ”¹è¿›URLæ ¼å¼éªŒè¯
- è¯¦ç»†çš„é”™è¯¯åˆ†ç±»å’Œæ—¥å¿—è®°å½•
- è¿”å›æœ¬åœ°åŒ–çš„é”™è¯¯æ¶ˆæ¯key

#### `server_form_page.dart`
- ä½¿ç”¨æ–°çš„é”™è¯¯å¯¹è¯æ¡†æ›¿ä»£ç®€å•çš„SnackBar
- æ ¹æ®é”™è¯¯ç±»å‹æä¾›ç›¸åº”çš„æç¤ºä¿¡æ¯
- æä¾›é‡è¯•æŒ‰é’®ï¼Œæ–¹ä¾¿ç”¨æˆ·å¿«é€Ÿé‡æ–°æµ‹è¯•

### 4. æ”¹è¿›ä»ªè¡¨ç›˜æ¨¡å—

#### `dashboard_error_view.dart`
- æ˜¾ç¤ºå‹å¥½çš„é”™è¯¯æ¶ˆæ¯
- æ ¹æ®é”™è¯¯ç±»å‹æ˜¾ç¤ºç›¸åº”çš„æç¤º
- æä¾›"æŸ¥çœ‹è¯¦æƒ…"æŒ‰é’®ï¼Œæ˜¾ç¤ºå®Œæ•´é”™è¯¯ä¿¡æ¯
- ä¿ç•™é‡è¯•åŠŸèƒ½

#### `dashboard_provider.dart`
- æ·»åŠ  `originalError` å­—æ®µä¿å­˜åŸå§‹é”™è¯¯å¯¹è±¡
- åœ¨catchå—ä¸­ä¿å­˜åŸå§‹é”™è¯¯ï¼Œä¾¿äºè¯¦ç»†åˆ†æ

### 5. åˆ›å»ºä½¿ç”¨æ–‡æ¡£

- **`docs/ERROR_HANDLING_GUIDE.md`**: å®Œæ•´çš„é”™è¯¯å¤„ç†ç³»ç»Ÿä½¿ç”¨æŒ‡å—
  - æ ¸å¿ƒç»„ä»¶è¯´æ˜
  - ä½¿ç”¨ç¤ºä¾‹
  - æœ€ä½³å®è·µ
  - å¸¸è§é—®é¢˜è§£ç­”

## æ”¹è¿›æ•ˆæœ

### ç”¨æˆ·ä½“éªŒæå‡

1. **é”™è¯¯ä¿¡æ¯æ›´æ¸…æ™°**: ä»ç®€å•çš„"è¿æ¥å¤±è´¥"å˜ä¸ºå…·ä½“çš„"è¿æ¥è¶…æ—¶ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥æˆ–ç¨åé‡è¯•"

2. **æä¾›è§£å†³å»ºè®®**: æ¯ä¸ªé”™è¯¯éƒ½é™„å¸¦ğŸ’¡æç¤ºï¼ŒæŒ‡å¯¼ç”¨æˆ·å¦‚ä½•è§£å†³é—®é¢˜

3. **æ”¯æŒé‡è¯•**: æ‰€æœ‰é”™è¯¯è§†å›¾éƒ½æä¾›é‡è¯•æŒ‰é’®ï¼Œæ— éœ€é‡æ–°å¡«å†™è¡¨å•

4. **å¯æŸ¥çœ‹è¯¦æƒ…**: å¼€å‘è€…å’Œé«˜çº§ç”¨æˆ·å¯ä»¥æŸ¥çœ‹å®Œæ•´çš„é”™è¯¯ä¿¡æ¯å’Œå †æ ˆè·Ÿè¸ª

### ä»£ç è´¨é‡æå‡

1. **ç»Ÿä¸€çš„é”™è¯¯å¤„ç†**: æ‰€æœ‰æ¨¡å—ä½¿ç”¨ç›¸åŒçš„é”™è¯¯å¤„ç†ç»„ä»¶ï¼Œä¿è¯ä¸€è‡´æ€§

2. **æ˜“äºæ‰©å±•**: æ–°å¢é”™è¯¯ç±»å‹åªéœ€åœ¨ARBæ–‡ä»¶ä¸­æ·»åŠ æ¶ˆæ¯

3. **å®Œå–„çš„æ—¥å¿—**: æ‰€æœ‰é”™è¯¯éƒ½ä¼šè®°å½•åˆ°æ—¥å¿—ç³»ç»Ÿï¼Œä¾¿äºè°ƒè¯•

4. **ç±»å‹å®‰å…¨**: ä½¿ç”¨æšä¸¾æ˜ç¡®é”™è¯¯ç±»å‹ï¼Œé¿å…é­”æ³•å­—ç¬¦ä¸²

## ä½¿ç”¨ç¤ºä¾‹

### åœ¨æ–°åŠŸèƒ½ä¸­ä½¿ç”¨é”™è¯¯å¤„ç†

```dart
// 1. åœ¨Providerä¸­æ•è·é”™è¯¯å¹¶ä¿å­˜åŸå§‹é”™è¯¯
try {
  await _loadData();
} catch (e) {
  _errorMessage = e.toString();
  _originalError = e; // ä¿å­˜åŸå§‹é”™è¯¯
  notifyListeners();
}

// 2. åœ¨UIä¸­æ˜¾ç¤ºé”™è¯¯è§†å›¾
if (provider.errorMessage != null) {
  return ErrorHelper.buildErrorView(
    context: context,
    error: provider.errorMessage,
    onRetry: () => provider.loadData(),
    originalError: provider.originalError,
  );
}

// 3. æˆ–è€…åœ¨å¼‚æ­¥æ“ä½œä¸­ä½¿ç”¨
final result = await ErrorHelper.handleAsyncOperation(
  context: context,
  operation: () => api.getData(),
  loadingMessage: 'æ­£åœ¨åŠ è½½...',
  showErrorDialog: true,
);
```

## åç»­å»ºè®®

1. **åœ¨æ‰€æœ‰åŠŸèƒ½æ¨¡å—ä¸­åº”ç”¨**:
   - Appsæ¨¡å—
   - Containersæ¨¡å—
   - Filesæ¨¡å—
   - Websitesæ¨¡å—
   - Databasesæ¨¡å—
   - ç­‰ç­‰...

2. **æ·»åŠ é”™è¯¯ä¸ŠæŠ¥åŠŸèƒ½**:
   - å°†é”™è¯¯ä¿¡æ¯ä¸ŠæŠ¥åˆ°æœåŠ¡å™¨
   - ç”¨äºåˆ†æå’Œæ”¹è¿›äº§å“

3. **æ·»åŠ ç½‘ç»œè¯Šæ–­å·¥å…·**:
   - ä¸€é”®æ£€æµ‹ç½‘ç»œè¿æ¥
   - ç”Ÿæˆè¯Šæ–­æŠ¥å‘Š

4. **æ·»åŠ å¸®åŠ©æ–‡æ¡£é“¾æ¥**:
   - åœ¨é”™è¯¯å¯¹è¯æ¡†ä¸­æ·»åŠ "æŸ¥çœ‹å¸®åŠ©"æŒ‰é’®
   - è·³è½¬åˆ°ç›¸å…³çš„æ–‡æ¡£é¡µé¢

## æ–‡ä»¶æ¸…å•

### æ–°å¢æ–‡ä»¶
- `lib/core/services/error_handler_service.dart` (10699å­—èŠ‚)
- `lib/core/services/error_helper.dart` (10258å­—èŠ‚)
- `docs/ERROR_HANDLING_GUIDE.md` (6880å­—èŠ‚)
- `docs/IMPROVEMENTS_SUMMARY.md` (æœ¬æ–‡ä»¶)

### ä¿®æ”¹æ–‡ä»¶
- `lib/l10n/app_zh.arb` (+80æ¡é”™è¯¯æ¶ˆæ¯)
- `lib/l10n/app_en.arb` (+80æ¡é”™è¯¯æ¶ˆæ¯)
- `lib/features/server/server_connection_service.dart`
- `lib/features/server/server_form_page.dart`
- `lib/features/dashboard/dashboard_page.dart`
- `lib/features/dashboard/dashboard_provider.dart`
- `lib/features/dashboard/widgets/dashboard_error_view.dart`

## æµ‹è¯•å»ºè®®

1. **è¿æ¥æµ‹è¯•åœºæ™¯**:
   - æ–­ç½‘çŠ¶æ€ä¸‹æµ‹è¯•è¿æ¥
   - è¾“å…¥é”™è¯¯çš„URL
   - è¾“å…¥é”™è¯¯çš„APIå¯†é’¥
   - æœåŠ¡å™¨å…³é—­çŠ¶æ€
   - SSLè¯ä¹¦é”™è¯¯

2. **ä»ªè¡¨ç›˜åŠ è½½åœºæ™¯**:
   - ç½‘ç»œå¼‚å¸¸
   - æœåŠ¡å™¨è¿”å›é”™è¯¯
   - APIè¶…æ—¶

3. **ç”¨æˆ·ä½“éªŒæµ‹è¯•**:
   - æ–°æ‰‹ç”¨æˆ·æ˜¯å¦èƒ½ç†è§£é”™è¯¯ä¿¡æ¯
   - æç¤ºä¿¡æ¯æ˜¯å¦æœ‰åŠ©äºè§£å†³é—®é¢˜
   - é‡è¯•åŠŸèƒ½æ˜¯å¦æ­£å¸¸å·¥ä½œ

## æ€»ç»“

è¿™æ¬¡æ”¹è¿›ä¸º1Panel Openåº”ç”¨å»ºç«‹äº†ä¸€ä¸ªå®Œå–„çš„é”™è¯¯å¤„ç†ç³»ç»Ÿï¼Œä¸ä»…è§£å†³äº†"çœ‹ä¸åˆ°é”™è¯¯åŸå› "çš„é—®é¢˜ï¼Œè¿˜ä¸ºç”¨æˆ·æä¾›äº†è¯¦ç»†çš„è§£å†³å»ºè®®å’Œå‹å¥½çš„äº¤äº’ä½“éªŒã€‚ç»Ÿä¸€çš„é”™è¯¯å¤„ç†ç»„ä»¶ä½¿åç»­åŠŸèƒ½çš„é”™è¯¯å¤„ç†æ›´åŠ ç®€å•å’Œä¸€è‡´ã€‚

è¯¥ç³»ç»Ÿå·²å‡†å¤‡å°±ç»ªï¼Œå¯ä»¥åœ¨å…¶ä»–åŠŸèƒ½æ¨¡å—ä¸­å¿«é€Ÿåº”ç”¨ã€‚
